<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>EvaluationConfig.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Card Fraud Rule Engine</a> &gt; <a href="index.source.html" class="el_package">com.fraud.engine.config</a> &gt; <span class="el_source">EvaluationConfig.java</span></div><h1>EvaluationConfig.java</h1><pre class="source lang-java linenums">package com.fraud.engine.config;

import jakarta.enterprise.context.ApplicationScoped;
import org.eclipse.microprofile.config.inject.ConfigProperty;

import java.security.SecureRandom;

/**
 * Configuration for rule evaluation behavior.
 * &lt;p&gt;
 * Controls debug mode and evaluation settings across all environments.
 * Use the same compiled ruleset path everywhere - debug mode only affects
 * the verbosity of output, not the execution path.
 * &lt;p&gt;
 * &lt;b&gt;Zero-Overhead Debug:&lt;/b&gt; Debug mode uses a static final boolean check
 * that is evaluated at compile time. When debug is disabled, the JVM completely
 * eliminates the debug code path with zero runtime overhead.
 *
 * @see ADR-0009 for details on compiled ruleset debug mode
 * @see ADR-0013 for zero-overhead debug mode design
 */
@ApplicationScoped
<span class="fc" id="L23">public class EvaluationConfig {</span>

    /**
     * Static flag for zero-overhead debug check.
     * This is evaluated at class loading time and cached as a constant,
     * providing zero runtime overhead when debug is disabled.
     */
<span class="pc" id="L30">    private static final boolean DEBUG_ENABLED =</span>
<span class="pc bpc" id="L31" title="1 of 2 branches missed.">            Boolean.getBoolean(&quot;app.evaluation.debug.enabled&quot;) ||</span>
<span class="pc bpc" id="L32" title="1 of 2 branches missed.">            Boolean.parseBoolean(System.getenv(&quot;APP_EVALUATION_DEBUG_ENABLED&quot;));</span>

    /**
     * Whether debug mode is enabled via config property.
     * Kept for backward compatibility - prefer using static DEBUG_ENABLED flag.
     */
    @ConfigProperty(name = &quot;app.evaluation.debug.enabled&quot;, defaultValue = &quot;false&quot;)
    public boolean debugEnabled;

    /**
     * Gets the static debug enabled flag for zero-overhead checks.
     *
     * @return true if debug mode is statically enabled
     */
    public static boolean isStaticDebugEnabled() {
<span class="fc" id="L47">        return DEBUG_ENABLED;</span>
    }

    /**
     * Whether to include field values in debug output.
     * &lt;p&gt;
     * May be disabled for PII/privacy reasons.
     * Default: true
     */
    @ConfigProperty(name = &quot;app.evaluation.debug.includeFieldValues&quot;, defaultValue = &quot;true&quot;)
    public boolean includeFieldValues;

    /**
     * Maximum number of condition evaluations to capture.
     * &lt;p&gt;
     * Prevents memory issues with very large rulesets.
     * Default: 100
     */
    @ConfigProperty(name = &quot;app.evaluation.debug.maxConditionEvaluations&quot;, defaultValue = &quot;100&quot;)
    public int maxConditionEvaluations;

    /**
     * Percentage of requests to sample for debug (0-100).
     * &lt;p&gt;
     * Allows enabling debug mode on a subset of traffic.
     * Default: 100 (all requests when debug.enabled=true)
     */
    @ConfigProperty(name = &quot;app.evaluation.debug.sampleRate&quot;, defaultValue = &quot;100&quot;)
    public int debugSampleRate;

<span class="fc" id="L77">    private static final SecureRandom RANDOM = new SecureRandom();</span>

    /**
     * Checks if debug mode should be enabled for this request.
     * &lt;p&gt;
     * Uses static flag first for zero-overhead check in production.
     * Falls back to config property for dynamic control.
     *
     * @return true if debug should be captured
     */
    public boolean shouldCaptureDebug() {
<span class="pc bpc" id="L88" title="1 of 4 branches missed.">        if (!DEBUG_ENABLED &amp;&amp; !debugEnabled) {</span>
<span class="fc" id="L89">            return false;</span>
        }
<span class="fc bfc" id="L91" title="All 2 branches covered.">        if (debugSampleRate &gt;= 100) {</span>
<span class="fc" id="L92">            return true;</span>
        }
<span class="fc bfc" id="L94" title="All 2 branches covered.">        if (debugSampleRate &lt;= 0) {</span>
<span class="fc" id="L95">            return false;</span>
        }
<span class="fc bfc" id="L97" title="All 2 branches covered.">        return RANDOM.nextInt(100) &lt; debugSampleRate;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>