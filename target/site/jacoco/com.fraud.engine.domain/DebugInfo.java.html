<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DebugInfo.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Card Fraud Rule Engine</a> &gt; <a href="index.source.html" class="el_package">com.fraud.engine.domain</a> &gt; <span class="el_source">DebugInfo.java</span></div><h1>DebugInfo.java</h1><pre class="source lang-java linenums">package com.fraud.engine.domain;

import com.fasterxml.jackson.annotation.JsonInclude;
import com.fasterxml.jackson.annotation.JsonProperty;

import java.time.Instant;
import java.util.ArrayList;
import java.util.Collections;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

/**
 * Detailed debugging information for rule evaluation.
 * &lt;p&gt;
 * Only populated when {@code app.evaluation.debug.enabled=true}.
 * This ensures production performance is not impacted while providing
 * full debugging capability when needed.
 * &lt;p&gt;
 * Debug mode uses the same compiled ruleset code path - execution
 * is identical to production, only additional information is captured.
 *
 * @see ADR-0009 for details on debug mode design
 */
@JsonInclude(JsonInclude.Include.NON_NULL)
public class DebugInfo {

    @JsonProperty(&quot;condition_evaluations&quot;)
    private List&lt;ConditionEvaluation&gt; conditionEvaluations;

    @JsonProperty(&quot;field_values&quot;)
    private Map&lt;String, Object&gt; fieldValues;

    @JsonProperty(&quot;compilation_timestamp&quot;)
    private Long compilationTimestamp;

    @JsonProperty(&quot;compiled_ruleset_version&quot;)
    private String compiledRulesetVersion;

    @JsonProperty(&quot;timing&quot;)
    private EvaluationTiming timing;

    @JsonProperty(&quot;ruleset_key&quot;)
    private String rulesetKey;

<span class="fc" id="L46">    public DebugInfo() {</span>
<span class="fc" id="L47">        this.conditionEvaluations = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L48">        this.fieldValues = new HashMap&lt;&gt;();</span>
<span class="fc" id="L49">    }</span>

<span class="fc" id="L51">    public DebugInfo(List&lt;ConditionEvaluation&gt; conditionEvaluations,</span>
                     Map&lt;String, Object&gt; fieldValues,
                     Long compilationTimestamp,
                     String compiledRulesetVersion,
                     EvaluationTiming timing) {
<span class="pc bpc" id="L56" title="1 of 2 branches missed.">        this.conditionEvaluations = conditionEvaluations != null</span>
<span class="fc" id="L57">                ? new ArrayList&lt;&gt;(conditionEvaluations)</span>
<span class="nc" id="L58">                : new ArrayList&lt;&gt;();</span>
<span class="pc bpc" id="L59" title="1 of 2 branches missed.">        this.fieldValues = fieldValues != null</span>
<span class="fc" id="L60">                ? new HashMap&lt;&gt;(fieldValues)</span>
<span class="nc" id="L61">                : new HashMap&lt;&gt;();</span>
<span class="fc" id="L62">        this.compilationTimestamp = compilationTimestamp;</span>
<span class="fc" id="L63">        this.compiledRulesetVersion = compiledRulesetVersion;</span>
<span class="fc" id="L64">        this.timing = timing;</span>
<span class="fc" id="L65">    }</span>

    public DebugInfo(List&lt;ConditionEvaluation&gt; conditionEvaluations,
                     Map&lt;String, Object&gt; fieldValues,
                     Long compilationTimestamp,
                     String compiledRulesetVersion,
                     EvaluationTiming timing,
                     String rulesetKey) {
<span class="fc" id="L73">        this(conditionEvaluations, fieldValues, compilationTimestamp, compiledRulesetVersion, timing);</span>
<span class="fc" id="L74">        this.rulesetKey = rulesetKey;</span>
<span class="fc" id="L75">    }</span>

    /**
     * Adds a condition evaluation result.
     */
    public void addConditionEvaluation(ConditionEvaluation evaluation) {
<span class="fc" id="L81">        this.conditionEvaluations.add(evaluation);</span>
<span class="fc" id="L82">    }</span>

    /**
     * Adds a field value.
     */
    public void addFieldValue(String fieldName, Object value) {
<span class="nc" id="L88">        this.fieldValues.put(fieldName, value);</span>
<span class="nc" id="L89">    }</span>

    /**
     * Creates an empty debug info (when debug mode is disabled).
     */
    public static DebugInfo empty() {
<span class="fc" id="L95">        return new DebugInfo(Collections.emptyList(), Collections.emptyMap(), null, null, null);</span>
    }

    // Getters and Setters

    public List&lt;ConditionEvaluation&gt; getConditionEvaluations() {
<span class="fc" id="L101">        return conditionEvaluations;</span>
    }

    public void setConditionEvaluations(List&lt;ConditionEvaluation&gt; conditionEvaluations) {
<span class="nc" id="L105">        this.conditionEvaluations = conditionEvaluations;</span>
<span class="nc" id="L106">    }</span>

    public Map&lt;String, Object&gt; getFieldValues() {
<span class="fc" id="L109">        return fieldValues;</span>
    }

    public void setFieldValues(Map&lt;String, Object&gt; fieldValues) {
<span class="nc" id="L113">        this.fieldValues = fieldValues;</span>
<span class="nc" id="L114">    }</span>

    public Long getCompilationTimestamp() {
<span class="fc" id="L117">        return compilationTimestamp;</span>
    }

    public void setCompilationTimestamp(Long compilationTimestamp) {
<span class="fc" id="L121">        this.compilationTimestamp = compilationTimestamp;</span>
<span class="fc" id="L122">    }</span>

    public String getCompiledRulesetVersion() {
<span class="fc" id="L125">        return compiledRulesetVersion;</span>
    }

    public void setCompiledRulesetVersion(String compiledRulesetVersion) {
<span class="fc" id="L129">        this.compiledRulesetVersion = compiledRulesetVersion;</span>
<span class="fc" id="L130">    }</span>

    public EvaluationTiming getTiming() {
<span class="nc" id="L133">        return timing;</span>
    }

    public void setTiming(EvaluationTiming timing) {
<span class="nc" id="L137">        this.timing = timing;</span>
<span class="nc" id="L138">    }</span>

    public String getRulesetKey() {
<span class="fc" id="L141">        return rulesetKey;</span>
    }

    public void setRulesetKey(String rulesetKey) {
<span class="fc" id="L145">        this.rulesetKey = rulesetKey;</span>
<span class="fc" id="L146">    }</span>

    /**
     * Result of evaluating a single condition.
     */
    @JsonInclude(JsonInclude.Include.NON_NULL)
    public static class ConditionEvaluation {

        @JsonProperty(&quot;rule_id&quot;)
        private String ruleId;

        @JsonProperty(&quot;rule_name&quot;)
        private String ruleName;

        @JsonProperty(&quot;field&quot;)
        private String field;

        @JsonProperty(&quot;operator&quot;)
        private String operator;

        @JsonProperty(&quot;expected_value&quot;)
        private Object expectedValue;

        @JsonProperty(&quot;actual_value&quot;)
        private Object actualValue;

        @JsonProperty(&quot;matched&quot;)
        private boolean matched;

        @JsonProperty(&quot;evaluation_time_nanos&quot;)
        private long evaluationTimeNanos;

        @JsonProperty(&quot;explanation&quot;)
        private String explanation;

<span class="fc" id="L181">        public ConditionEvaluation() {</span>
<span class="fc" id="L182">        }</span>

<span class="fc" id="L184">        public ConditionEvaluation(String ruleId, String ruleName, String field,</span>
                                   String operator, Object expectedValue,
                                   Object actualValue, boolean matched,
                                   long evaluationTimeNanos, String explanation) {
<span class="fc" id="L188">            this.ruleId = ruleId;</span>
<span class="fc" id="L189">            this.ruleName = ruleName;</span>
<span class="fc" id="L190">            this.field = field;</span>
<span class="fc" id="L191">            this.operator = operator;</span>
<span class="fc" id="L192">            this.expectedValue = expectedValue;</span>
<span class="fc" id="L193">            this.actualValue = actualValue;</span>
<span class="fc" id="L194">            this.matched = matched;</span>
<span class="fc" id="L195">            this.evaluationTimeNanos = evaluationTimeNanos;</span>
<span class="fc" id="L196">            this.explanation = explanation;</span>
<span class="fc" id="L197">        }</span>

        // Getters and Setters

        public String getRuleId() {
<span class="fc" id="L202">            return ruleId;</span>
        }

        public void setRuleId(String ruleId) {
<span class="fc" id="L206">            this.ruleId = ruleId;</span>
<span class="fc" id="L207">        }</span>

        public String getRuleName() {
<span class="fc" id="L210">            return ruleName;</span>
        }

        public void setRuleName(String ruleName) {
<span class="nc" id="L214">            this.ruleName = ruleName;</span>
<span class="nc" id="L215">        }</span>

        public String getField() {
<span class="fc" id="L218">            return field;</span>
        }

        public void setField(String field) {
<span class="fc" id="L222">            this.field = field;</span>
<span class="fc" id="L223">        }</span>

        public String getOperator() {
<span class="fc" id="L226">            return operator;</span>
        }

        public void setOperator(String operator) {
<span class="fc" id="L230">            this.operator = operator;</span>
<span class="fc" id="L231">        }</span>

        public Object getExpectedValue() {
<span class="fc" id="L234">            return expectedValue;</span>
        }

        public void setExpectedValue(Object expectedValue) {
<span class="fc" id="L238">            this.expectedValue = expectedValue;</span>
<span class="fc" id="L239">        }</span>

        public Object getActualValue() {
<span class="fc" id="L242">            return actualValue;</span>
        }

        public void setActualValue(Object actualValue) {
<span class="fc" id="L246">            this.actualValue = actualValue;</span>
<span class="fc" id="L247">        }</span>

        public boolean isMatched() {
<span class="fc" id="L250">            return matched;</span>
        }

        public void setMatched(boolean matched) {
<span class="fc" id="L254">            this.matched = matched;</span>
<span class="fc" id="L255">        }</span>

        public long getEvaluationTimeNanos() {
<span class="fc" id="L258">            return evaluationTimeNanos;</span>
        }

        public void setEvaluationTimeNanos(long evaluationTimeNanos) {
<span class="fc" id="L262">            this.evaluationTimeNanos = evaluationTimeNanos;</span>
<span class="fc" id="L263">        }</span>

        public String getExplanation() {
<span class="fc" id="L266">            return explanation;</span>
        }

        public void setExplanation(String explanation) {
<span class="fc" id="L270">            this.explanation = explanation;</span>
<span class="fc" id="L271">        }</span>
    }

    /**
     * Timing breakdown for evaluation phases.
     */
    @JsonInclude(JsonInclude.Include.NON_NULL)
    public static class EvaluationTiming {

        @JsonProperty(&quot;compilation_nanos&quot;)
        private Long compilationNanos;

        @JsonProperty(&quot;evaluation_nanos&quot;)
        private Long evaluationNanos;

        @JsonProperty(&quot;velocity_nanos&quot;)
        private Long velocityNanos;

        @JsonProperty(&quot;total_nanos&quot;)
        private Long totalNanos;

<span class="fc" id="L292">        public EvaluationTiming() {</span>
<span class="fc" id="L293">        }</span>

<span class="fc" id="L295">        public EvaluationTiming(Long compilationNanos, Long evaluationNanos, Long velocityNanos) {</span>
<span class="fc" id="L296">            this.compilationNanos = compilationNanos;</span>
<span class="fc" id="L297">            this.evaluationNanos = evaluationNanos;</span>
<span class="fc" id="L298">            this.velocityNanos = velocityNanos;</span>
<span class="fc bfc" id="L299" title="All 2 branches covered.">            this.totalNanos = (compilationNanos != null ? compilationNanos : 0)</span>
<span class="pc bpc" id="L300" title="1 of 2 branches missed.">                    + (evaluationNanos != null ? evaluationNanos : 0)</span>
<span class="fc bfc" id="L301" title="All 2 branches covered.">                    + (velocityNanos != null ? velocityNanos : 0);</span>
<span class="fc" id="L302">        }</span>

        // Getters and Setters

        public Long getCompilationNanos() {
<span class="fc" id="L307">            return compilationNanos;</span>
        }

        public void setCompilationNanos(Long compilationNanos) {
<span class="fc" id="L311">            this.compilationNanos = compilationNanos;</span>
<span class="fc" id="L312">            recalculateTotal();</span>
<span class="fc" id="L313">        }</span>

        public Long getEvaluationNanos() {
<span class="fc" id="L316">            return evaluationNanos;</span>
        }

        public void setEvaluationNanos(Long evaluationNanos) {
<span class="fc" id="L320">            this.evaluationNanos = evaluationNanos;</span>
<span class="fc" id="L321">            recalculateTotal();</span>
<span class="fc" id="L322">        }</span>

        public Long getVelocityNanos() {
<span class="fc" id="L325">            return velocityNanos;</span>
        }

        public void setVelocityNanos(Long velocityNanos) {
<span class="fc" id="L329">            this.velocityNanos = velocityNanos;</span>
<span class="fc" id="L330">            recalculateTotal();</span>
<span class="fc" id="L331">        }</span>

        public Long getTotalNanos() {
<span class="fc" id="L334">            return totalNanos;</span>
        }

        public void setTotalNanos(Long totalNanos) {
<span class="nc" id="L338">            this.totalNanos = totalNanos;</span>
<span class="nc" id="L339">        }</span>

        private void recalculateTotal() {
<span class="pc bpc" id="L342" title="1 of 2 branches missed.">            this.totalNanos = (compilationNanos != null ? compilationNanos : 0)</span>
<span class="fc bfc" id="L343" title="All 2 branches covered.">                    + (evaluationNanos != null ? evaluationNanos : 0)</span>
<span class="fc bfc" id="L344" title="All 2 branches covered.">                    + (velocityNanos != null ? velocityNanos : 0);</span>
<span class="fc" id="L345">        }</span>
    }

    /**
     * Builder for constructing DebugInfo during evaluation.
     */
<span class="fc" id="L351">    public static class Builder {</span>
<span class="fc" id="L352">        private final List&lt;ConditionEvaluation&gt; conditionEvaluations = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L353">        private final Map&lt;String, Object&gt; fieldValues = new HashMap&lt;&gt;();</span>
        private Long compilationTimestamp;
        private String compiledRulesetVersion;
        private EvaluationTiming timing;
        private String rulesetKey;

        public Builder rulesetKey(String rulesetKey) {
<span class="fc" id="L360">            this.rulesetKey = rulesetKey;</span>
<span class="fc" id="L361">            return this;</span>
        }

        public Builder compilationTimestamp(Long timestamp) {
<span class="fc" id="L365">            this.compilationTimestamp = timestamp;</span>
<span class="fc" id="L366">            return this;</span>
        }

        public Builder compiledRulesetVersion(String version) {
<span class="fc" id="L370">            this.compiledRulesetVersion = version;</span>
<span class="fc" id="L371">            return this;</span>
        }

        public Builder timing(EvaluationTiming timing) {
<span class="fc" id="L375">            this.timing = timing;</span>
<span class="fc" id="L376">            return this;</span>
        }

        public Builder addConditionEvaluation(ConditionEvaluation evaluation) {
<span class="fc" id="L380">            this.conditionEvaluations.add(evaluation);</span>
<span class="fc" id="L381">            return this;</span>
        }

        public Builder addFieldValue(String fieldName, Object value) {
<span class="fc" id="L385">            this.fieldValues.put(fieldName, value);</span>
<span class="fc" id="L386">            return this;</span>
        }

        public int getConditionEvaluationCount() {
<span class="fc" id="L390">            return conditionEvaluations.size();</span>
        }

        public DebugInfo build() {
<span class="fc" id="L394">            return new DebugInfo(</span>
<span class="fc" id="L395">                    conditionEvaluations,</span>
<span class="fc" id="L396">                    fieldValues,</span>
<span class="fc" id="L397">                    compilationTimestamp,</span>
<span class="fc" id="L398">                    compiledRulesetVersion,</span>
<span class="fc" id="L399">                    timing,</span>
<span class="fc" id="L400">                    rulesetKey</span>
            );
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>