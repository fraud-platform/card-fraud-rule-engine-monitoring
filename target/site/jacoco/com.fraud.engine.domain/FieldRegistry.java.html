<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FieldRegistry.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Card Fraud Rule Engine</a> &gt; <a href="index.source.html" class="el_package">com.fraud.engine.domain</a> &gt; <span class="el_source">FieldRegistry.java</span></div><h1>FieldRegistry.java</h1><pre class="source lang-java linenums">package com.fraud.engine.domain;

import java.util.HashMap;
import java.util.Map;

/**
 * Centralized registry for field identifiers used in rule evaluation.
 * &lt;p&gt;
 * This class provides a mapping between field names (as strings) and integer field IDs.
 * Using integer IDs instead of string names provides:
 * &lt;ul&gt;
 *   &lt;li&gt;Faster comparisons (int vs String)&lt;/li&gt;
 *   &lt;li&gt;Better CPU branch prediction&lt;/li&gt;
 *   &lt;li&gt;Reduced memory allocations&lt;/li&gt;
 *   &lt;li&gt;Cache-friendly access patterns&lt;/li&gt;
 * &lt;/ul&gt;
 * &lt;p&gt;
 * This is now the single source of truth for field IDs. TransactionContext.F_* constants
 * reference these values, and ConditionCompiler uses {@link #fromName(String)} for lookup.
 *
 * @see TransactionContext - Uses the F_* constants which reference these values
 */
public final class FieldRegistry {

    // ========== Field IDs ==========
    // These match the constants in TransactionContext
    // Field IDs start from 1 (not 0) to align with rule-management

    public static final int TRANSACTION_ID = 1;
    public static final int CARD_HASH = 2;
    public static final int AMOUNT = 3;
    public static final int CURRENCY = 4;
    public static final int MERCHANT_ID = 5;
    public static final int MERCHANT_NAME = 6;
    public static final int MERCHANT_CATEGORY = 7;
    public static final int MERCHANT_CATEGORY_CODE = 8;
    public static final int CARD_PRESENT = 9;
    public static final int TRANSACTION_TYPE = 10;
    public static final int ENTRY_MODE = 11;
    public static final int COUNTRY_CODE = 12;
    public static final int IP_ADDRESS = 13;
    public static final int DEVICE_ID = 14;
    public static final int EMAIL = 15;
    public static final int PHONE = 16;
    public static final int TIMESTAMP = 17;
    public static final int BILLING_CITY = 18;
    public static final int BILLING_COUNTRY = 19;
    public static final int BILLING_POSTAL_CODE = 20;
    public static final int SHIPPING_CITY = 21;
    public static final int SHIPPING_COUNTRY = 22;
    public static final int SHIPPING_POSTAL_CODE = 23;

    // Scope-related fields for rule bucketing
    public static final int CARD_NETWORK = 24;
    public static final int CARD_BIN = 25;
    public static final int CARD_LOGO = 26;

    // Number of standard fields (max ID + 1)
    public static final int FIELD_COUNT = 27;

    // Field ID for unknown/custom fields (any field not in the standard list)
    public static final int UNKNOWN = 0;

    // ========== Name to ID Mapping ==========

    private static final Map&lt;String, Integer&gt; NAME_TO_ID;

    static {
<span class="fc" id="L69">        Map&lt;String, Integer&gt; map = new HashMap&lt;&gt;(32);</span>

        // Standard fields
<span class="fc" id="L72">        map.put(&quot;transaction_id&quot;, TRANSACTION_ID);</span>
<span class="fc" id="L73">        map.put(&quot;card_hash&quot;, CARD_HASH);</span>
<span class="fc" id="L74">        map.put(&quot;amount&quot;, AMOUNT);</span>
<span class="fc" id="L75">        map.put(&quot;currency&quot;, CURRENCY);</span>
<span class="fc" id="L76">        map.put(&quot;merchant_id&quot;, MERCHANT_ID);</span>
<span class="fc" id="L77">        map.put(&quot;merchant_name&quot;, MERCHANT_NAME);</span>
<span class="fc" id="L78">        map.put(&quot;merchant_category&quot;, MERCHANT_CATEGORY);</span>
<span class="fc" id="L79">        map.put(&quot;merchant_category_code&quot;, MERCHANT_CATEGORY_CODE);</span>
<span class="fc" id="L80">        map.put(&quot;card_present&quot;, CARD_PRESENT);</span>
<span class="fc" id="L81">        map.put(&quot;transaction_type&quot;, TRANSACTION_TYPE);</span>
<span class="fc" id="L82">        map.put(&quot;entry_mode&quot;, ENTRY_MODE);</span>
<span class="fc" id="L83">        map.put(&quot;country_code&quot;, COUNTRY_CODE);</span>
<span class="fc" id="L84">        map.put(&quot;ip_address&quot;, IP_ADDRESS);</span>
<span class="fc" id="L85">        map.put(&quot;device_id&quot;, DEVICE_ID);</span>
<span class="fc" id="L86">        map.put(&quot;email&quot;, EMAIL);</span>
<span class="fc" id="L87">        map.put(&quot;phone&quot;, PHONE);</span>
<span class="fc" id="L88">        map.put(&quot;timestamp&quot;, TIMESTAMP);</span>
<span class="fc" id="L89">        map.put(&quot;billing_city&quot;, BILLING_CITY);</span>
<span class="fc" id="L90">        map.put(&quot;billing_country&quot;, BILLING_COUNTRY);</span>
<span class="fc" id="L91">        map.put(&quot;billing_postal_code&quot;, BILLING_POSTAL_CODE);</span>
<span class="fc" id="L92">        map.put(&quot;shipping_city&quot;, SHIPPING_CITY);</span>
<span class="fc" id="L93">        map.put(&quot;shipping_country&quot;, SHIPPING_COUNTRY);</span>
<span class="fc" id="L94">        map.put(&quot;shipping_postal_code&quot;, SHIPPING_POSTAL_CODE);</span>
<span class="fc" id="L95">        map.put(&quot;timestamp&quot;, TIMESTAMP);</span>

        // Scope-related fields
<span class="fc" id="L98">        map.put(&quot;card_network&quot;, CARD_NETWORK);</span>
<span class="fc" id="L99">        map.put(&quot;card_bin&quot;, CARD_BIN);</span>
<span class="fc" id="L100">        map.put(&quot;card_logo&quot;, CARD_LOGO);</span>

        // Aliases for common field variations
<span class="fc" id="L103">        map.put(&quot;txn_id&quot;, TRANSACTION_ID);</span>
<span class="fc" id="L104">        map.put(&quot;card&quot;, CARD_HASH);</span>
<span class="fc" id="L105">        map.put(&quot;merch_id&quot;, MERCHANT_ID);</span>
<span class="fc" id="L106">        map.put(&quot;merch_category&quot;, MERCHANT_CATEGORY);</span>
<span class="fc" id="L107">        map.put(&quot;mcc&quot;, MERCHANT_CATEGORY_CODE);</span>
<span class="fc" id="L108">        map.put(&quot;ip&quot;, IP_ADDRESS);</span>
<span class="fc" id="L109">        map.put(&quot;device&quot;, DEVICE_ID);</span>

        // Aliases for scope fields
<span class="fc" id="L112">        map.put(&quot;network&quot;, CARD_NETWORK);</span>
<span class="fc" id="L113">        map.put(&quot;bin&quot;, CARD_BIN);</span>
<span class="fc" id="L114">        map.put(&quot;logo&quot;, CARD_LOGO);</span>

<span class="fc" id="L116">        NAME_TO_ID = Map.copyOf(map);</span>
<span class="fc" id="L117">    }</span>

    // ========== Public Methods ==========

    /**
     * Gets the field ID for a given field name.
     *
     * @param fieldName the field name (e.g., &quot;card_hash&quot;, &quot;amount&quot;)
     * @return the field ID, or {@link #UNKNOWN} if not found
     */
    public static int fromName(String fieldName) {
<span class="fc bfc" id="L128" title="All 2 branches covered.">        if (fieldName == null) {</span>
<span class="fc" id="L129">            return UNKNOWN;</span>
        }
<span class="fc" id="L131">        Integer id = NAME_TO_ID.get(fieldName);</span>
<span class="fc bfc" id="L132" title="All 2 branches covered.">        return id != null ? id : UNKNOWN;</span>
    }

    /**
     * Gets the field name for a given field ID.
     * &lt;p&gt;This is primarily used for debugging and logging.
     *
     * @param fieldId the field ID
     * @return the field name, or &quot;UNKNOWN&quot; if not found
     */
    public static String getName(int fieldId) {
<span class="fc bfc" id="L143" title="All 27 branches covered.">        return switch (fieldId) {</span>
<span class="fc" id="L144">            case TRANSACTION_ID -&gt; &quot;transaction_id&quot;;</span>
<span class="fc" id="L145">            case CARD_HASH -&gt; &quot;card_hash&quot;;</span>
<span class="fc" id="L146">            case AMOUNT -&gt; &quot;amount&quot;;</span>
<span class="fc" id="L147">            case CURRENCY -&gt; &quot;currency&quot;;</span>
<span class="fc" id="L148">            case MERCHANT_ID -&gt; &quot;merchant_id&quot;;</span>
<span class="fc" id="L149">            case MERCHANT_NAME -&gt; &quot;merchant_name&quot;;</span>
<span class="fc" id="L150">            case MERCHANT_CATEGORY -&gt; &quot;merchant_category&quot;;</span>
<span class="fc" id="L151">            case MERCHANT_CATEGORY_CODE -&gt; &quot;merchant_category_code&quot;;</span>
<span class="fc" id="L152">            case CARD_PRESENT -&gt; &quot;card_present&quot;;</span>
<span class="fc" id="L153">            case TRANSACTION_TYPE -&gt; &quot;transaction_type&quot;;</span>
<span class="fc" id="L154">            case ENTRY_MODE -&gt; &quot;entry_mode&quot;;</span>
<span class="fc" id="L155">            case COUNTRY_CODE -&gt; &quot;country_code&quot;;</span>
<span class="fc" id="L156">            case IP_ADDRESS -&gt; &quot;ip_address&quot;;</span>
<span class="fc" id="L157">            case DEVICE_ID -&gt; &quot;device_id&quot;;</span>
<span class="fc" id="L158">            case EMAIL -&gt; &quot;email&quot;;</span>
<span class="fc" id="L159">            case PHONE -&gt; &quot;phone&quot;;</span>
<span class="fc" id="L160">            case TIMESTAMP -&gt; &quot;timestamp&quot;;</span>
<span class="fc" id="L161">            case BILLING_CITY -&gt; &quot;billing_city&quot;;</span>
<span class="fc" id="L162">            case BILLING_COUNTRY -&gt; &quot;billing_country&quot;;</span>
<span class="fc" id="L163">            case BILLING_POSTAL_CODE -&gt; &quot;billing_postal_code&quot;;</span>
<span class="fc" id="L164">            case SHIPPING_CITY -&gt; &quot;shipping_city&quot;;</span>
<span class="fc" id="L165">            case SHIPPING_COUNTRY -&gt; &quot;shipping_country&quot;;</span>
<span class="fc" id="L166">            case SHIPPING_POSTAL_CODE -&gt; &quot;shipping_postal_code&quot;;</span>
<span class="fc" id="L167">            case CARD_NETWORK -&gt; &quot;card_network&quot;;</span>
<span class="fc" id="L168">            case CARD_BIN -&gt; &quot;card_bin&quot;;</span>
<span class="fc" id="L169">            case CARD_LOGO -&gt; &quot;card_logo&quot;;</span>
<span class="fc" id="L170">            default -&gt; &quot;UNKNOWN&quot;;</span>
        };
    }

    /**
     * Checks if a field ID is valid (a standard field).
     * Field IDs start from 1, not 0.
     *
     * @param fieldId the field ID to check
     * @return true if the field ID is valid, false otherwise
     */
    public static boolean isValid(int fieldId) {
<span class="fc bfc" id="L182" title="All 4 branches covered.">        return fieldId &gt;= 1 &amp;&amp; fieldId &lt; FIELD_COUNT;</span>
    }

    /**
     * Gets the total number of standard fields.
     *
     * @return the field count
     */
    public static int getFieldCount() {
<span class="fc" id="L191">        return FIELD_COUNT;</span>
    }

    // Prevent instantiation
<span class="nc" id="L195">    private FieldRegistry() {</span>
<span class="nc" id="L196">        throw new UnsupportedOperationException(&quot;Utility class&quot;);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>