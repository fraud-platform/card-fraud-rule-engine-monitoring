# Sample ruleset for integration testing
# This ruleset tests various condition operators and velocity checks

key: CARD_AUTH
version: 1
name: Card AUTH Test Rules
description: Sample ruleset for integration testing of the fraud rule engine
evaluation_type: AUTH
active: true
created_by: integration-test
created_at: 2026-01-21T00:00:00Z

rules:
  # Rule 1: High amount transaction - should DECLINE
  - id: high-amount
    name: High Amount Transaction
    description: Decline transactions over $5000
    action: DECLINE
    priority: 100
    enabled: true
    conditions:
      - field: amount
        operator: gt
        value: 5000

  # Rule 2: High risk merchant category - should REVIEW
  - id: high-risk-merchant
    name: High Risk Merchant Category
    description: Review transactions from high-risk merchants
    action: REVIEW
    priority: 90
    enabled: true
    conditions:
      - field: merchant_category
        operator: in
        values:
          - "5411"
          - "5812"
          - "5814"
          - "7995"

  # Rule 3: Specific country check - should DECLINE
  - id: blocked-country
    name: Blocked Country
    description: Decline transactions from blocked countries
    action: DECLINE
    priority: 80
    enabled: true
    conditions:
      - field: country_code
        operator: eq
        value: "XX"

  # Rule 4: Velocity check - card velocity
  - id: card-velocity
    name: Card Velocity Check
    description: Decline if more than 3 transactions in 1 hour
    action: DECLINE
    priority: 70
    enabled: true
    conditions:
      - field: card_hash
        operator: exists
        value: true
    velocity:
      dimension: card_hash
      window_seconds: 3600
      threshold: 3
      action: DECLINE

  # Rule 5: Amount range check using multiple conditions
  - id: amount-range
    name: Suspicious Amount Range
    description: Review amounts between $1000 and $2000
    action: REVIEW
    priority: 60
    enabled: true
    conditions:
      - field: amount
        operator: gte
        value: 1000
      - field: amount
        operator: lte
        value: 2000

  # Rule 6: Currency check - should APPROVE (but lower priority)
  - id: valid-currency
    name: Valid Currency
    description: Approve transactions in supported currencies
    action: APPROVE
    priority: 10
    enabled: true
    conditions:
      - field: currency
        operator: in
        values:
          - "USD"
          - "EUR"
          - "GBP"
          - "CAD"

  # Rule 7: Regex pattern match - merchant name contains "TEST"
  - id: test-merchant
    name: Test Merchant Detection
    description: Flag transactions with test merchants
    action: REVIEW
    priority: 50
    enabled: true
    conditions:
      - field: merchant_name
        operator: regex
        value: ".*TEST.*"

  # Rule 8: Disabled rule - should be skipped
  - id: disabled-rule
    name: Disabled Rule
    description: This rule is disabled and should be skipped
    action: DECLINE
    priority: 200
    enabled: false
    conditions:
      - field: amount
        operator: gt
        value: 100
