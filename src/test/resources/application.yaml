# Test Configuration for Unit Tests
# This file provides test values for all required configuration
# No external dependencies (MinIO, Doppler) required for unit tests

quarkus:
  application:
    name: card-fraud-rule-engine-test

  # HTTP Configuration
  http:
    # Use an ephemeral test port to avoid conflicts with a running local container.
    test-port: 0
    port: 8081
    host: 0.0.0.0
    limits:
      max-body-size: 1M

  # Redis Configuration - use testcontainers or local Redis
  redis:
    hosts: redis://localhost:6379

  # Kafka Configuration
  kafka:
    bootstrap-servers: localhost:9092

  # Disable fault tolerance for tests
  smallrye-fault-tolerance:
    enabled: false

  # Logging - minimal for tests
  log:
    level: WARN
    console:
      enable: true
      format: "%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{3.}] (%t) %s%e%n"
    category:
      "com.fraud.engine":
        level: DEBUG
      "io.quarkus.redis":
        level: WARN
      "io.vertx":
        level: WARN

  # Disable devservices for tests
  devservices:
    enabled: false

  # Swagger/OpenAPI - disabled for unit tests
  swagger-ui:
    always-include: false
  openapi:
    path: /openapi
    info-title: Card Fraud Rule Engine API (Test)
    info-version: 1.0.0-test
    info-description: Test configuration

# S3 / MinIO Configuration - mocked for tests
s3:
  endpoint-url: http://localhost:9000
  aws:
    region: us-east-1
    credentials:
      static-provider:
        access-key-id: test-access-key
        secret-access-key: test-secret-key

# Application-specific Configuration for Tests
app:
  ruleset:
    bucket: test-fraud-artifacts
    path-prefix: test-rulesets/
    yaml-fallback-enabled: true
    environment: test
    startup:
      load-enabled: false
      rulesets: CARD_AUTH,CARD_MONITORING
      fail-fast: false
      environment: test
    auto-reload:
      enabled: false
      interval-seconds: 60
  field-registry:
    path-prefix: fields/
    poll-interval-seconds: 30
    enable-hot-reload: false
  startup:
    validation:
      enabled: false
  hot-reload:
    poll-interval-seconds: 30
  velocity:
    default-window-seconds: 3600
    default-threshold: 10
  decision:
    fail-open: true
    default-decision: APPROVE
  evaluation:
    debug:
      enabled: true

# Messaging Configuration for Tests
mp:
  messaging:
    outgoing:
      decision-events:
        connector: smallrye-kafka
        topic: test.fraud.decisions.v1
        bootstrap.servers: localhost:9092
        key.serializer: org.apache.kafka.common.serialization.StringSerializer
        value.serializer: org.apache.kafka.common.serialization.StringSerializer
  fault:
    tolerance:
      enabled: false

# SmallRye config for tests
smallrye:
  faulttolerance:
    enabled: false

"%test":
  quarkus:
    redis:
      hosts: redis://localhost:6379
    kafka:
      bootstrap-servers: localhost:9092
    smallrye-fault-tolerance:
      enabled: false
  smallrye:
    faulttolerance:
      enabled: false
  mp:
    fault:
      tolerance:
        enabled: false
    messaging:
      outgoing:
        decision-events:
          connector: smallrye-kafka
          topic: test.fraud.decisions.v1
          bootstrap.servers: localhost:9092
          key.serializer: org.apache.kafka.common.serialization.StringSerializer
          value.serializer: org.apache.kafka.common.serialization.StringSerializer
